language: android
jdk: oraclejdk8
sudo: false
android:
  components:
     - tools
     - platform-tools
     - build-tools-26.0.0
     - android-24
     - android-25
     - tools
     - sys-img-armeabi-v7a-google_apis-24
  licenses:
   - 'android-sdk-license-.+'   

env:
  global:
    - API=24 # Android API level 24 by default
    - TAG=google_apis # Google APIs by default, alternatively use default
    - ABI=armeabi-v7a # ARM ABI v7a by default
    - ADB_INSTALL_TIMEOUT=8

before_install:
  - export EMULATOR="system-images;android-${API};${TAG};${ABI}"

install:
  - echo yes | sdkmanager "tools"
  - echo yes | sdkmanager "platforms;android-24"
  - echo yes | sdkmanager "$EMULATOR"

before_script:
  - function emulator { cd "$(dirname "$(which emulator)")" && ./emulator "$@"; }
  - echo no | android create avd --force -n test -k $EMULATOR
  - emulator -avd test -no-skin -no-audio -no-window &
  - android-wait-for-emulator
  - adb shell input keyevent 82 &

script:
  - ./gradlew build
  - ./gradlew test
  - ./gradlew test connectedAndroidTest
